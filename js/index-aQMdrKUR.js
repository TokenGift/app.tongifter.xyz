import{R as e,r as t,m as n,e as o,f as a,_ as l,l as s,n as i,o as r,p as c,q as d,t as u,v as m,x as p,y as v,A as f,z as _,B as y,j as g,c as b,i as h,u as x,C as w,a as k,M as E,S as C,D as j,s as N,$ as T,d as S}from"./index-BaFS1eFu.js";import{D as A}from"./dot-loading-lKDhS6yb.js";import{i as O}from"./validate-C3fzEUzl.js";import{u as I,I as R}from"./image-CL6oheDI.js";import{d as P,u as $}from"./popup-DniD0LAU.js";import{a as M}from"./attach-properties-to-component-CClyKAqJ.js";import{S as D}from"./index-QcRVWQo_.js";import{i as z,a as B}from"./icon_refresh-9vnDdaeD.js";import F from"./index-CnzmKZaw.js";import"./index-q1QrccOP.js";import"./empty-DwPaR-9C.js";import"./icon_tgt-CrhvpaUb.js";import"./icon_token_ton-CiNinKlB.js";import"./icon_token_x-BgQHK46Y.js";import"./index-DRiNxNdV.js";import"./useCustomNavigate-CpNr3K7h.js";import"./SendOutline-cvKN80Va.js";const V="adm-button",U={color:"default",fill:"solid",block:!1,loading:!1,loadingIcon:e.createElement(A,{color:"currentColor"}),type:"button",shape:"default",size:"middle"},L=t.forwardRef(((s,i)=>{const r=n(U,s),[c,d]=t.useState(!1),u=t.useRef(null),m="auto"===r.loading?c:r.loading,p=r.disabled||m;t.useImperativeHandle(i,(()=>({get nativeElement(){return u.current}})));return o(r,e.createElement("button",{ref:u,type:r.type,onClick:e=>l(void 0,void 0,void 0,(function*(){if(!r.onClick)return;const t=r.onClick(e);if(O(t))try{d(!0),yield t,d(!1)}catch(n){throw d(!1),n}})),className:a(V,{[`${V}-${r.color}`]:r.color,[`${V}-block`]:r.block,[`${V}-disabled`]:p,[`${V}-fill-outline`]:"outline"===r.fill,[`${V}-fill-none`]:"none"===r.fill,[`${V}-mini`]:"mini"===r.size,[`${V}-small`]:"small"===r.size,[`${V}-large`]:"large"===r.size,[`${V}-loading`]:m},`${V}-shape-${r.shape}`),disabled:p,onMouseDown:r.onMouseDown,onMouseUp:r.onMouseUp,onTouchStart:r.onTouchStart,onTouchEnd:r.onTouchEnd},m?e.createElement("div",{className:`${V}-loading-wrapper`},r.loadingIcon,r.loadingText):e.createElement("span",null,r.children)))})),G="adm-center-popup",H=Object.assign(Object.assign({},P),{getContainer:null}),q=l=>{const{popup:f={}}=s(),_=n(H,f,l),y=i(),g=r({scale:_.visible?1:.8,opacity:_.visible?1:0,config:{mass:1.2,tension:200,friction:25,clamp:!0},onRest:()=>{var e,t;y.current||(h(_.visible),_.visible?null===(e=_.afterShow)||void 0===e||e.call(_):null===(t=_.afterClose)||void 0===t||t.call(_))}}),[b,h]=t.useState(_.visible);I((()=>{_.visible&&h(!0)}),[_.visible]);const x=t.useRef(null);c(x,_.disableBodyScroll&&b);const w=$(b&&_.visible),k=e.createElement("div",{className:a(`${G}-body`,_.bodyClassName),style:_.bodyStyle},_.children),E=d(_.stopPropagation,o(_,e.createElement("div",{className:G,style:{display:b?void 0:"none",pointerEvents:b?void 0:"none"}},_.mask&&e.createElement(u,{visible:w,forceRender:_.forceRender,destroyOnClose:_.destroyOnClose,onMaskClick:e=>{var t,n;null===(t=_.onMaskClick)||void 0===t||t.call(_,e),_.closeOnMaskClick&&(null===(n=_.onClose)||void 0===n||n.call(_))},style:_.maskStyle,className:a(`${G}-mask`,_.maskClassName),disableBodyScroll:!1,stopPropagation:_.stopPropagation}),e.createElement("div",{className:`${G}-wrap`,role:_.role,"aria-label":_["aria-label"]},e.createElement(m.div,{style:Object.assign(Object.assign({},g),{pointerEvents:g.opacity.to((e=>1===e?"unset":"none"))}),ref:x},_.showCloseButton&&e.createElement("a",{className:a(`${G}-close`,"adm-plain-anchor"),onClick:()=>{var e;null===(e=_.onClose)||void 0===e||e.call(_)}},_.closeIcon),k)))));return e.createElement(p,{active:b,forceRender:_.forceRender,destroyOnClose:_.destroyOnClose},v(_.getContainer,E))},K=t=>{const{action:n}=t;return o(t.action,e.createElement(L,{key:n.key,onClick:t.onAction,className:a("adm-dialog-button",{"adm-dialog-button-bold":n.bold}),fill:"none",shape:"rectangular",block:!0,color:n.danger?"danger":"primary",loading:"auto",disabled:n.disabled},n.text))},X={actions:[],closeOnAction:!1,closeOnMaskClick:!1,getContainer:null},W=t=>{const o=n(X,t),s=e.createElement(e.Fragment,null,!!o.image&&e.createElement("div",{className:Z("image-container")},e.createElement(R,{src:o.image,alt:"dialog header image",width:"100%"})),!!o.header&&e.createElement("div",{className:Z("header")},e.createElement(f,null,o.header)),!!o.title&&e.createElement("div",{className:Z("title")},o.title),e.createElement("div",{className:a(Z("content"),!o.content&&Z("content-empty"))},"string"==typeof o.content?e.createElement(f,null,o.content):o.content),e.createElement("div",{className:Z("footer")},o.actions.map(((t,n)=>{const a=Array.isArray(t)?t:[t];return e.createElement("div",{className:Z("action-row"),key:n},a.map(((t,n)=>e.createElement(K,{key:t.key,action:t,onAction:()=>l(void 0,void 0,void 0,(function*(){var e,a,l;yield Promise.all([null===(e=t.onClick)||void 0===e?void 0:e.call(t),null===(a=o.onAction)||void 0===a?void 0:a.call(o,t,n)]),o.closeOnAction&&(null===(l=o.onClose)||void 0===l||l.call(o))}))}))))}))));return e.createElement(q,{className:a(Z(),o.className),style:o.style,afterClose:o.afterClose,afterShow:o.afterShow,onMaskClick:o.closeOnMaskClick?()=>{var e;null===(e=o.onClose)||void 0===e||e.call(o)}:void 0,visible:o.visible,getContainer:o.getContainer,bodyStyle:o.bodyStyle,bodyClassName:a(Z("body"),o.image&&Z("with-image"),o.bodyClassName),maskStyle:o.maskStyle,maskClassName:o.maskClassName,stopPropagation:o.stopPropagation,disableBodyScroll:o.disableBodyScroll,destroyOnClose:o.destroyOnClose,forceRender:o.forceRender,role:"dialog","aria-label":o["aria-label"]},s)};function Z(e=""){return"adm-dialog"+(e&&"-")+e}const J=new Set;function Q(t){const n=_(e.createElement(W,Object.assign({},t,{afterClose:()=>{var e;J.delete(n.close),null===(e=t.afterClose)||void 0===e||e.call(t)}})));return J.add(n.close),n}const Y={confirmText:"确认",cancelText:"取消"};const ee=M(W,{show:Q,alert:function(e){const t={confirmText:y().locale.Dialog.ok},o=n(t,e);return new Promise((e=>{Q(Object.assign(Object.assign({},o),{closeOnAction:!0,actions:[{key:"confirm",text:o.confirmText}],onAction:o.onConfirm,onClose:()=>{var t;null===(t=o.onClose)||void 0===t||t.call(o),e()}}))}))},confirm:function(e){const{locale:t}=y(),o=n(Y,{confirmText:t.common.confirm,cancelText:t.common.cancel},e);return new Promise((e=>{Q(Object.assign(Object.assign({},o),{closeOnAction:!0,onClose:()=>{var t;null===(t=o.onClose)||void 0===t||t.call(o),e(!1)},actions:[[{key:"cancel",text:o.cancelText,onClick:()=>l(this,void 0,void 0,(function*(){var t;yield null===(t=o.onCancel)||void 0===t?void 0:t.call(o),e(!1)}))},{key:"confirm",text:o.confirmText,bold:!0,onClick:()=>l(this,void 0,void 0,(function*(){var t;yield null===(t=o.onConfirm)||void 0===t?void 0:t.call(o),e(!0)}))}]]}))}))},clear:function(){J.forEach((e=>{e()}))}}),te="_avatar_ceno8_20",ne="_coin_icon_ceno8_40",oe="_list_item_ceno8_43",ae="_task_row_ceno8_66",le="_task_column_ceno8_81",se="_item_title_ceno8_87",ie="_item_content_ceno8_96",re="_do_ceno8_104",ce="_center_row_ceno8_116",de="_open_btn_ceno8_127",ue="_open_btn_border_ceno8_140",me="_bottom_banner_widget_ceno8_152",pe="_bottom_banner_ceno8_152",ve="_bottom_content_ceno8_177";var fe=t.forwardRef((({as:e="div",...t},n)=>g.jsx(e,{...t,ref:n}))),_e="cf-turnstile-script",ye="onloadTurnstileCallback",ge=e=>!!document.getElementById(e),be={normal:{width:300,height:65},compact:{width:150,height:140},invisible:{width:0,height:0,overflow:"hidden"},flexible:{minWidth:300,width:"100%",height:65},interactionOnly:{width:"fit-content",height:"auto",display:"flex"}};function he(e){if("invisible"!==e&&"interactionOnly"!==e)return e}var xe,we="unloaded",ke=new Promise(((e,t)=>{xe={resolve:e,reject:t},"ready"===we&&e(void 0)})),Ee=t.forwardRef(((e,n)=>{let{scriptOptions:o,options:a={},siteKey:l,onWidgetLoad:s,onSuccess:i,onExpire:r,onError:c,onBeforeInteractive:d,onAfterInteractive:u,onUnsupported:m,onTimeout:p,onLoadScript:v,id:f,style:_,as:y="div",injectScript:b=!0,...h}=e,x=a.size,w=t.useCallback((()=>typeof x>"u"?{}:"execute"===a.execution?be.invisible:"interaction-only"===a.appearance?be.interactionOnly:be[x]),[a.execution,x,a.appearance]),[k,E]=t.useState(w()),C=t.useRef(null),[j,N]=t.useState(!1),T=t.useRef(),S=t.useRef(!1),A=f||"cf-turnstile",O=(null==o?void 0:o.id)||_e,I=function(e=_e){let[n,o]=t.useState(!1);return t.useEffect((()=>{let t=()=>{ge(e)&&o(!0)},n=new MutationObserver(t);return n.observe(document,{childList:!0,subtree:!0}),t(),()=>{n.disconnect()}}),[e]),n}(O),R=(null==o?void 0:o.onLoadCallbackName)||ye,P=a.appearance||"always",$=t.useMemo((()=>({sitekey:l,action:a.action,cData:a.cData,callback:e=>{S.current=!0,null==i||i(e)},"error-callback":c,"expired-callback":r,"before-interactive-callback":d,"after-interactive-callback":u,"unsupported-callback":m,theme:a.theme||"auto",language:a.language||"auto",tabindex:a.tabIndex,"response-field":a.responseField,"response-field-name":a.responseFieldName,size:he(x),retry:a.retry||"auto","retry-interval":a.retryInterval||8e3,"refresh-expired":a.refreshExpired||"auto","refresh-timeout":a.refreshTimeout||"auto",execution:a.execution||"render",appearance:a.appearance||"always","feedback-enabled":a.feedbackEnabled||!0,"timeout-callback":p})),[a.action,a.appearance,a.cData,a.execution,a.language,a.refreshExpired,a.responseField,a.responseFieldName,a.retry,a.retryInterval,a.tabIndex,a.theme,a.feedbackEnabled,a.refreshTimeout,l,x]),M=t.useCallback((()=>typeof window<"u"&&!!window.turnstile),[]);return t.useEffect((function(){b&&!j&&(({render:e="explicit",onLoadCallbackName:t=ye,scriptOptions:{nonce:n="",defer:o=!0,async:a=!0,id:l="",appendTo:s,onError:i,crossOrigin:r=""}={}})=>{let c=l||_e;if(ge(c))return;let d=document.createElement("script");d.id=c,d.src=`https://challenges.cloudflare.com/turnstile/v0/api.js?onload=${t}&render=${e}`,document.querySelector(`script[src="${d.src}"]`)||(d.defer=!!o,d.async=!!a,n&&(d.nonce=n),r&&(d.crossOrigin=r),i&&(d.onerror=i,delete window[t]),("body"===s?document.body:document.getElementsByTagName("head")[0]).appendChild(d))})({onLoadCallbackName:R,scriptOptions:{...o,id:O}})}),[b,j,o,O]),t.useEffect((function(){"ready"!==we&&((e=ye)=>("unloaded"===we&&(we="loading",window[e]=()=>{xe.resolve(),we="ready",delete window[e]}),ke))(R).then((()=>N(!0))).catch(console.error)}),[]),t.useEffect((function(){if(!C.current||!j)return;let e=!1;return(async()=>{if(e||!C.current)return;let t=window.turnstile.render(C.current,$);T.current=t,T.current&&(null==s||s(T.current))})(),()=>{e=!0,T.current&&(window.turnstile.remove(T.current),S.current=!1)}}),[A,j,$]),t.useImperativeHandle(n,(()=>{let{turnstile:e}=window;return{getResponse(){if((null==e?void 0:e.getResponse)&&T.current&&M())return e.getResponse(T.current);console.warn("Turnstile has not been loaded")},getResponsePromise:async(e=3e4,t=100)=>new Promise(((n,o)=>{let a,l=async()=>{if(S.current&&window.turnstile&&T.current)try{let e=window.turnstile.getResponse(T.current);return a&&clearTimeout(a),e?n(e):o(new Error("No response received"))}catch(s){return a&&clearTimeout(a),console.warn("Failed to get response",s),o(new Error("Failed to get response"))}a||(a=setTimeout((()=>{a&&clearTimeout(a),o(new Error("Timeout"))}),e)),await new Promise((e=>setTimeout(e,t))),await l()};l()})),reset(){if((null==e?void 0:e.reset)&&T.current&&M()){"execute"===a.execution&&E(be.invisible);try{S.current=!1,e.reset(T.current)}catch(t){console.warn(`Failed to reset Turnstile widget ${T}`,t)}}else console.warn("Turnstile has not been loaded")},remove(){(null==e?void 0:e.remove)&&T.current&&M()?(E(be.invisible),S.current=!1,e.remove(T.current),T.current=null):console.warn("Turnstile has not been loaded")},render(){if(!(null==e?void 0:e.render)||!C.current||!M()||T.current)return void console.warn("Turnstile has not been loaded or container not found");let t=e.render(C.current,$);return T.current=t,T.current&&(null==s||s(T.current)),"execute"!==a.execution&&E(x?be[x]:{}),t},execute(){"execute"===a.execution?(null==e?void 0:e.execute)&&C.current&&T.current&&M()?(e.execute(C.current,$),E(x?be[x]:{})):console.warn("Turnstile has not been loaded or container not found"):console.warn('Execution mode is not set to "execute"')},isExpired:()=>(null==e?void 0:e.isExpired)&&T.current&&M()?e.isExpired(T.current):(console.warn("Turnstile has not been loaded"),!1)}}),[T,a.execution,x,$,C,M,j,s]),t.useEffect((()=>{I&&!j&&window.turnstile&&N(!0)}),[j,I]),t.useEffect((()=>{E(w())}),[a.execution,x,P]),t.useEffect((()=>{!I||"function"!=typeof v||v()}),[I]),g.jsx(fe,{ref:C,as:y,id:A,style:{...k,..._},...h})}));Ee.displayName="Turnstile";const{VITE_APP_ENV:Ce}={BASE_URL:"/",DEV:!1,MODE:"prod",PROD:!0,SSR:!1,VITE_APP_ENV:"prod",VITE_BASE_URL:"https://api.tongifter.xyz",VITE_RECHARGE_ADDRESS:"0QBVHX3_gVwPZnzKPob1zpZ3tOX67xXzuFe_Ux2Pyr_R7Yms"},{getGiftInfo:je,getTaskProgress:Ne,updateTask:Te,openGift:Se}=T("common"),Ae=b((e=>e.common))((n=>{var o,a,l,s,i;const{tgUserInfoRaw:r,tgUserInfo:c}=n,{location:d,pathname:u,search:m,hash:p}=h(),{t:v,i18n:f}=x(),[_]=w(),y=_.get("id"),b=_.get("inviterId"),[T,A]=t.useState("0x4AAAAAAA0Gfu6U8AVORjc0"),[O,I]=t.useState(!1),P=e.useRef(),[$,M]=t.useState({}),[V,U]=t.useState({}),[L,G]=t.useState(0),[H,q]=t.useState(!1),[K,X]=t.useState(!1),[W,Z]=t.useState(!1),J=async()=>{const[e]=await Ne(r,{id:y});200===(null==e?void 0:e.code)&&U(null==e?void 0:e.data)},Q=e=>{V.task.map((t=>t.taskId===e.taskId?{...t,...e}:t));let t={...V};U(t)},Y=e=>{if(e)return e.completed?void 0:1===e.status?g.jsx(R,{className:ne,src:B,width:32,height:32,placeholder:g.jsx(D.Paragraph,{style:{width:"100%"}}),onClick:t=>{t.stopPropagation(),fe(e)},style:{borderRadius:10}}):2===e.status?g.jsx(C,{style:{"--size":"24px","--color":"red"}}):g.jsx("div",{className:re,children:v("receive_btn_do")})},fe=async e=>{e.status=2,Q(e);const[t]=await Te(r,{giftId:y,taskId:e.taskId});200===(null==t?void 0:t.code)&&J()},_e=async()=>{q(!1),Z(!0),X(!0)},ye=async()=>{var e;await J(),V.completed?(null==(e=P.current)||e.render(),I(!0)):N(v("receive_tips_tips_1"),3)},ge=()=>{"prod"!=Ce&&A("1x00000000000000000000AA"),(async()=>{const[e]=await je(r,{id:y});200===(null==e?void 0:e.code)?M(null==e?void 0:e.data):S.show({content:v(null==e?void 0:e.message),position:"top"})})(),J()};return k.useActivate((()=>{ge()})),t.useEffect((()=>{ge()}),[d]),t.useEffect((()=>{var e;null!=V.completed&&null!=$.gift&&(99==$.gift.status||$.gift.userId==c.id?G(2):(V.completed||(G(1),K||(q(!0),X(!1))),V.completed&&(null==(e=$.myAward)?void 0:e.surplusTimes)<=0&&G(2),V.completed&&(null==$.myAward||$.myAward.surplusTimes>0)&&(G(1),q(!1),X(!0))))}),[V,$]),g.jsxs("div",{className:"warp",children:[0==L?g.jsx("div",{className:"content1",style:{padding:"16px"},children:g.jsx(D,{className:ve,animated:!0})}):null,1==L?g.jsxs("div",{className:"content1",style:{padding:"16px"},children:[W?null:g.jsx("div",{className:ve,style:{backgroundImage:`url(${null==(o=$.gift)?void 0:o.coverImg})`}}),W?g.jsx("div",{className:ve,style:{backgroundImage:`url(${null==(a=$.gift)?void 0:a.coverImg})`},children:null==(l=V.task)?void 0:l.map(((e,t)=>g.jsxs("div",{className:oe,onClick:()=>{(async e=>{e.status=1,Q(e),1==e.type&&E("web_app_open_tg_link",{path_full:e.value.replace("@","")}),2==e.type&&E("web_app_open_link",{url:e.value,try_instant_view:!1})})(e)},children:[g.jsxs("div",{className:ae,children:[e.completed?g.jsx(R,{className:te,src:z,width:30,height:30,fit:"cover",style:{borderRadius:14}}):g.jsx(R,{className:te,src:"/img/icon_lock.Bp71GFIS.jpg",width:30,height:30,fit:"cover",style:{borderRadius:14}}),g.jsxs("div",{className:le,children:[g.jsx("span",{className:se,children:e.title}),g.jsx("span",{className:ie,children:e.desc})]})]}),Y(e)]},t)))}):null,g.jsxs("div",{className:ce,children:[K?g.jsx("div",{onClick:async()=>{var e,t,n;if(V.completed)if((null==(e=$.myAward)?void 0:e.surplusTimes)>0)if("prod"!=Ce)ee.confirm({content:v("add_recive_more_confirm_content",{v1:null==(t=$.myAward)?void 0:t.surplusTimes}),cancelText:v("add_recive_more_confirm_cancel_text"),confirmText:v("add_recive_more_confirm_confirm_text"),onConfirm:()=>{alert(1)}});else{E("web_app_open_popup",{title:v("add_recive_more_confirm_tips"),message:v("add_recive_more_confirm_content",{v1:null==(n=$.myAward)?void 0:n.surplusTimes}),buttons:[{id:"0x0ok",type:"default",text:v("add_recive_more_confirm_confirm_text")},{id:"0x0close",type:"default",text:v("add_recive_more_confirm_cancel_text")}]});const e=j("popup_closed",(t=>{e(),"0x0ok"===t.button_id&&ye()}))}else ye()},className:ue,children:g.jsx("div",{className:de,children:v("receive_btn_receive")})}):null,H?g.jsx("div",{onClick:_e,className:ue,children:g.jsx("div",{onClick:_e,className:de,children:v("receive_btn_open")})}):null]}),(null==(s=$.myAward)?void 0:s.surplusTimes)>0?g.jsx("div",{className:me,children:g.jsx("div",{className:pe,children:v("add_recive_more_open_tips",{v1:null==(i=$.myAward)?void 0:i.surplusTimes})})}):null]}):null,2==L?g.jsx("div",{className:"content1",style:{color:"#ffffff"},children:g.jsx(F,{giftId:y})}):null,O?g.jsx("div",{className:"cf_turnstile_pop",onClick:e=>{I(!1)},children:g.jsx("div",{className:"item",children:g.jsx(Ee,{ref:P,siteKey:T,options:{language:f.language},onSuccess:e=>{(async e=>{var t;if(V.completed){I(!1);const[n]=await Se(r,{id:y,inviterId:b,cfvt:e});200===(null==n?void 0:n.code)?(N(v("receive_tips_tips_2",{v1:null==n?void 0:n.data,v2:null==(t=$.gift)?void 0:t.tokenSymbol}),1),G(2)):N(null==n?void 0:n.message,3)}else N(v("receive_tips_tips_1"),3)})(e)},onClick:e=>{e.stopPropagation()}})})}):null]})}));export{Ae as default};
