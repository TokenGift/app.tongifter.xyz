import{r as e,j as t,c as n,i as r,u as s,l as i,R as o,a,M as l,S as c,d,$ as u}from"./index-BAP-5rGd.js";import{I as m}from"./image-DM3iwibu.js";import{S as p}from"./index-CArCXmrT.js";import{i as f,a as _}from"./icon_refresh-9vnDdaeD.js";import v from"./index-AG5hH8Fw.js";import"./index-BvzqMizP.js";import"./attach-properties-to-component-CClyKAqJ.js";import"./empty-BIbEJyWL.js";import"./popup-CF-Pyuqa.js";import"./icon_tgt-CrhvpaUb.js";import"./icon_token_ton-CiNinKlB.js";import"./icon_token_not-NeONbRwt.js";import"./index-DUQyShgl.js";import"./useCustomNavigate-QDEnmjO1.js";import"./SendOutline-eFkbdFMp.js";const h="_avatar_8l6mm_20",x="_coin_icon_8l6mm_40",w="_list_item_8l6mm_43",g="_task_row_8l6mm_66",y="_task_column_8l6mm_81",b="_item_title_8l6mm_87",j="_item_content_8l6mm_96",k="_do_8l6mm_104",N="_center_row_8l6mm_116",E="_open_btn_8l6mm_127",I="_open_btn_border_8l6mm_140",T="_bottom_banner_widget_8l6mm_152",S="_bottom_banner_8l6mm_152",R="_bottom_content_8l6mm_176";var A=e.forwardRef((({as:e="div",...n},r)=>t.jsx(e,{...n,ref:r}))),C="cf-turnstile-script",O="onloadTurnstileCallback",P=e=>!!document.getElementById(e),F={normal:{width:300,height:65},compact:{width:150,height:140},invisible:{width:0,height:0,overflow:"hidden"},flexible:{minWidth:300,width:"100%",height:65},interactionOnly:{width:"fit-content",height:"auto",display:"flex"}};function L(e){if("invisible"!==e&&"interactionOnly"!==e)return e}var B,V="unloaded",$=new Promise(((e,t)=>{B={resolve:e,reject:t},"ready"===V&&e(void 0)})),D=e.forwardRef(((n,r)=>{let{scriptOptions:s,options:i={},siteKey:o,onWidgetLoad:a,onSuccess:l,onExpire:c,onError:d,onBeforeInteractive:u,onAfterInteractive:m,onUnsupported:p,onTimeout:f,onLoadScript:_,id:v,style:h,as:x="div",injectScript:w=!0,...g}=n,y=i.size,b=e.useCallback((()=>typeof y>"u"?{}:"execute"===i.execution?F.invisible:"interaction-only"===i.appearance?F.interactionOnly:F[y]),[i.execution,y,i.appearance]),[j,k]=e.useState(b()),N=e.useRef(null),[E,I]=e.useState(!1),T=e.useRef(),S=e.useRef(!1),R=v||"cf-turnstile",D=(null==s?void 0:s.id)||C,U=function(t=C){let[n,r]=e.useState(!1);return e.useEffect((()=>{let e=()=>{P(t)&&r(!0)},n=new MutationObserver(e);return n.observe(document,{childList:!0,subtree:!0}),e(),()=>{n.disconnect()}}),[t]),n}(D),G=(null==s?void 0:s.onLoadCallbackName)||O,M=i.appearance||"always",z=e.useMemo((()=>({sitekey:o,action:i.action,cData:i.cData,callback:e=>{S.current=!0,null==l||l(e)},"error-callback":d,"expired-callback":c,"before-interactive-callback":u,"after-interactive-callback":m,"unsupported-callback":p,theme:i.theme||"auto",language:i.language||"auto",tabindex:i.tabIndex,"response-field":i.responseField,"response-field-name":i.responseFieldName,size:L(y),retry:i.retry||"auto","retry-interval":i.retryInterval||8e3,"refresh-expired":i.refreshExpired||"auto","refresh-timeout":i.refreshTimeout||"auto",execution:i.execution||"render",appearance:i.appearance||"always","feedback-enabled":i.feedbackEnabled||!0,"timeout-callback":f})),[i.action,i.appearance,i.cData,i.execution,i.language,i.refreshExpired,i.responseField,i.responseFieldName,i.retry,i.retryInterval,i.tabIndex,i.theme,i.feedbackEnabled,i.refreshTimeout,o,y]),q=e.useCallback((()=>typeof window<"u"&&!!window.turnstile),[]);return e.useEffect((function(){w&&!E&&(({render:e="explicit",onLoadCallbackName:t=O,scriptOptions:{nonce:n="",defer:r=!0,async:s=!0,id:i="",appendTo:o,onError:a,crossOrigin:l=""}={}})=>{let c=i||C;if(P(c))return;let d=document.createElement("script");d.id=c,d.src=`https://challenges.cloudflare.com/turnstile/v0/api.js?onload=${t}&render=${e}`,document.querySelector(`script[src="${d.src}"]`)||(d.defer=!!r,d.async=!!s,n&&(d.nonce=n),l&&(d.crossOrigin=l),a&&(d.onerror=a,delete window[t]),("body"===o?document.body:document.getElementsByTagName("head")[0]).appendChild(d))})({onLoadCallbackName:G,scriptOptions:{...s,id:D}})}),[w,E,s,D]),e.useEffect((function(){"ready"!==V&&((e=O)=>("unloaded"===V&&(V="loading",window[e]=()=>{B.resolve(),V="ready",delete window[e]}),$))(G).then((()=>I(!0))).catch(console.error)}),[]),e.useEffect((function(){if(!N.current||!E)return;let e=!1;return(async()=>{if(e||!N.current)return;let t=window.turnstile.render(N.current,z);T.current=t,T.current&&(null==a||a(T.current))})(),()=>{e=!0,T.current&&(window.turnstile.remove(T.current),S.current=!1)}}),[R,E,z]),e.useImperativeHandle(r,(()=>{let{turnstile:e}=window;return{getResponse(){if((null==e?void 0:e.getResponse)&&T.current&&q())return e.getResponse(T.current);console.warn("Turnstile has not been loaded")},getResponsePromise:async(e=3e4,t=100)=>new Promise(((n,r)=>{let s,i=async()=>{if(S.current&&window.turnstile&&T.current)try{let e=window.turnstile.getResponse(T.current);return s&&clearTimeout(s),e?n(e):r(new Error("No response received"))}catch(o){return s&&clearTimeout(s),console.warn("Failed to get response",o),r(new Error("Failed to get response"))}s||(s=setTimeout((()=>{s&&clearTimeout(s),r(new Error("Timeout"))}),e)),await new Promise((e=>setTimeout(e,t))),await i()};i()})),reset(){if((null==e?void 0:e.reset)&&T.current&&q()){"execute"===i.execution&&k(F.invisible);try{S.current=!1,e.reset(T.current)}catch(t){console.warn(`Failed to reset Turnstile widget ${T}`,t)}}else console.warn("Turnstile has not been loaded")},remove(){(null==e?void 0:e.remove)&&T.current&&q()?(k(F.invisible),S.current=!1,e.remove(T.current),T.current=null):console.warn("Turnstile has not been loaded")},render(){if(!(null==e?void 0:e.render)||!N.current||!q()||T.current)return void console.warn("Turnstile has not been loaded or container not found");let t=e.render(N.current,z);return T.current=t,T.current&&(null==a||a(T.current)),"execute"!==i.execution&&k(y?F[y]:{}),t},execute(){"execute"===i.execution?(null==e?void 0:e.execute)&&N.current&&T.current&&q()?(e.execute(N.current,z),k(y?F[y]:{})):console.warn("Turnstile has not been loaded or container not found"):console.warn('Execution mode is not set to "execute"')},isExpired:()=>(null==e?void 0:e.isExpired)&&T.current&&q()?e.isExpired(T.current):(console.warn("Turnstile has not been loaded"),!1)}}),[T,i.execution,y,z,N,q,E,a]),e.useEffect((()=>{U&&!E&&window.turnstile&&I(!0)}),[E,U]),e.useEffect((()=>{k(b())}),[i.execution,y,M]),e.useEffect((()=>{!U||"function"!=typeof _||_()}),[U]),t.jsx(A,{ref:N,as:x,id:R,style:{...j,...h},...g})}));D.displayName="Turnstile";const{VITE_APP_ENV:U}={BASE_URL:"/",DEV:!1,MODE:"prod",PROD:!0,SSR:!1,VITE_APP_ENV:"prod",VITE_BASE_URL:"https://api.tongifter.xyz"},{getGiftInfo:G,getTaskProgress:M,updateTask:z,openGift:q}=u("common"),H=n((e=>e.common))((n=>{var u,A,C;const{tgUserInfoRaw:O,tgUserInfo:P}=n,{location:F,pathname:L,search:B,hash:V}=r(),{t:$,i18n:H}=s(),[K]=i(),W=K.get("id"),J=K.get("inviterId"),[Q,X]=e.useState("0x4AAAAAAA0Gfu6U8AVORjc0"),[Y,Z]=e.useState(!1),ee=o.useRef(),[te,ne]=e.useState({}),[re,se]=e.useState({}),[ie,oe]=e.useState(0),[ae,le]=e.useState(!1),[ce,de]=e.useState(!1),[ue,me]=e.useState(!1),pe=async()=>{const[e]=await M(O,{id:W});200===(null==e?void 0:e.code)&&se(null==e?void 0:e.data)},fe=e=>{re.task.map((t=>t.taskId===e.taskId?{...t,...e}:t));let t={...re};se(t)},_e=e=>{if(e)return e.completed?void 0:1===e.status?t.jsx(m,{className:x,src:_,width:32,height:32,placeholder:t.jsx(p.Paragraph,{style:{width:"100%"}}),onClick:t=>{t.stopPropagation(),ve(e)},style:{borderRadius:10}}):2===e.status?t.jsx(c,{style:{"--size":"24px","--color":"red"}}):t.jsx("div",{className:k,children:$("receive_btn_do")})},ve=async e=>{e.status=2,fe(e);const[t]=await z(O,{giftId:W,taskId:e.taskId});200===(null==t?void 0:t.code)&&pe()},he=async()=>{le(!1),me(!0),de(!0)},xe=async()=>{var e;await pe(),re.completed?(null==(e=ee.current)||e.render(),Z(!0)):d.show({content:$("receive_tips_tips_1"),position:"top"})},we=()=>{"prod"!=U&&X("1x00000000000000000000AA"),(async()=>{const[e]=await G(O,{id:W});200===(null==e?void 0:e.code)?ne(null==e?void 0:e.data):d.show({content:$(null==e?void 0:e.message),position:"top"})})(),pe()};return a.useActivate((()=>{we()})),e.useEffect((()=>{we()}),[F]),e.useEffect((()=>{var e;null!=re.completed&&null!=te.gift&&(99==te.gift.status||te.gift.userId==P.id?oe(2):(re.completed||(oe(1),ce||(le(!0),de(!1))),re.completed&&(null==(e=te.myAward)?void 0:e.surplusTimes)<=0&&oe(2),re.completed&&(null==te.myAward||te.myAward.surplusTimes>0)&&(oe(1),le(!1),de(!0))))}),[re,te]),t.jsxs("div",{className:"warp",children:[0==ie?t.jsx("div",{className:"content1",style:{padding:"16px"},children:t.jsx(p,{className:R,animated:!0})}):null,1==ie?t.jsxs("div",{className:"content1",style:{padding:"16px"},children:[ue?null:t.jsx("div",{className:R,style:{backgroundImage:`url(${null==(u=te.gift)?void 0:u.coverImg})`}}),ue?t.jsx("div",{className:R,style:{backgroundImage:`url(${null==(A=te.gift)?void 0:A.coverImg})`},children:null==(C=re.task)?void 0:C.map(((e,n)=>t.jsxs("div",{className:w,onClick:()=>{(async e=>{e.status=1,fe(e),1==e.type&&l("web_app_open_tg_link",{path_full:e.value.replace("@","")}),2==e.type&&l("web_app_open_link",{url:e.value,try_instant_view:!1})})(e)},children:[t.jsxs("div",{className:g,children:[e.completed?t.jsx(m,{className:h,src:f,width:30,height:30,fit:"cover",style:{borderRadius:14}}):t.jsx(m,{className:h,src:"/img/icon_lock.Bp71GFIS.jpg",width:30,height:30,fit:"cover",style:{borderRadius:14}}),t.jsxs("div",{className:y,children:[t.jsx("span",{className:b,children:e.title}),t.jsx("span",{className:j,children:e.desc})]})]}),_e(e)]},n)))}):null,t.jsxs("div",{className:N,children:[ce?t.jsx("div",{onClick:xe,className:I,children:t.jsx("div",{onClick:xe,className:E,children:$("receive_btn_receive")})}):null,ae?t.jsx("div",{onClick:he,className:I,children:t.jsx("div",{onClick:he,className:E,children:$("receive_btn_open")})}):null]}),t.jsx("div",{className:T,children:t.jsx("div",{className:S,children:$("receive_tips_max")})})]}):null,2==ie?t.jsx("div",{className:"content1",style:{color:"#ffffff"},children:t.jsx(v,{giftId:W})}):null,Y?t.jsx("div",{className:"cf_turnstile_pop",onClick:e=>{Z(!1)},children:t.jsx("div",{className:"item",children:t.jsx(D,{ref:ee,siteKey:Q,options:{language:H.language},onSuccess:e=>{(async e=>{var t;if(console.log("path x",L,B,V),re.completed){Z(!1);const[n]=await q(O,{id:W,inviterId:J,cfvt:e});200===(null==n?void 0:n.code)?(d.show({content:$("receive_tips_tips_2")+(null==n?void 0:n.data)+""+(null==(t=te.gift)?void 0:t.tokenSymbol),position:"top"}),confetti({particleCount:500,spread:200,origin:{y:.6}}),oe(2)):d.show({content:null==n?void 0:n.message,position:"top"})}else d.show({content:$("receive_tips_tips_1"),position:"top"})})(e)},onClick:e=>{e.stopPropagation()}})})}):null]})}));export{H as default};
