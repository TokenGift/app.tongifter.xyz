import{R as e,r as t,m as n,e as o,f as a,_ as l,l as i,n as s,o as r,p as c,q as d,t as u,v as m,x as p,y as v,A as f,z as _,B as y,j as g,c as b,i as h,u as x,C as w,a as k,M as E,S as C,D as j,s as N,$ as T}from"./index-ChUO8asy.js";import{D as S}from"./dot-loading-Bidk-TJ0.js";import{i as A}from"./validate-BJ8580VM.js";import{u as O,I}from"./image-CiAtEHlu.js";import{d as R,u as P}from"./popup-REt426YS.js";import{a as $}from"./attach-properties-to-component-CClyKAqJ.js";import{S as M}from"./index-BsZsFMGl.js";import{i as D,a as z}from"./icon_refresh-9vnDdaeD.js";import B from"./index-vyydXwiz.js";import"./index-_esMfcua.js";import"./empty-CmHewovR.js";import"./icon_tgt-CrhvpaUb.js";import"./icon_token_ton-CiNinKlB.js";import"./icon_token_x-BgQHK46Y.js";import"./index-HLfP_G5p.js";import"./useCustomNavigate-Bji8JmLV.js";import"./SendOutline-DYy9osFo.js";const F="adm-button",V={color:"default",fill:"solid",block:!1,loading:!1,loadingIcon:e.createElement(S,{color:"currentColor"}),type:"button",shape:"default",size:"middle"},U=t.forwardRef(((i,s)=>{const r=n(V,i),[c,d]=t.useState(!1),u=t.useRef(null),m="auto"===r.loading?c:r.loading,p=r.disabled||m;t.useImperativeHandle(s,(()=>({get nativeElement(){return u.current}})));return o(r,e.createElement("button",{ref:u,type:r.type,onClick:e=>l(void 0,void 0,void 0,(function*(){if(!r.onClick)return;const t=r.onClick(e);if(A(t))try{d(!0),yield t,d(!1)}catch(n){throw d(!1),n}})),className:a(F,{[`${F}-${r.color}`]:r.color,[`${F}-block`]:r.block,[`${F}-disabled`]:p,[`${F}-fill-outline`]:"outline"===r.fill,[`${F}-fill-none`]:"none"===r.fill,[`${F}-mini`]:"mini"===r.size,[`${F}-small`]:"small"===r.size,[`${F}-large`]:"large"===r.size,[`${F}-loading`]:m},`${F}-shape-${r.shape}`),disabled:p,onMouseDown:r.onMouseDown,onMouseUp:r.onMouseUp,onTouchStart:r.onTouchStart,onTouchEnd:r.onTouchEnd},m?e.createElement("div",{className:`${F}-loading-wrapper`},r.loadingIcon,r.loadingText):e.createElement("span",null,r.children)))})),L="adm-center-popup",G=Object.assign(Object.assign({},R),{getContainer:null}),H=l=>{const{popup:f={}}=i(),_=n(G,f,l),y=s(),g=r({scale:_.visible?1:.8,opacity:_.visible?1:0,config:{mass:1.2,tension:200,friction:25,clamp:!0},onRest:()=>{var e,t;y.current||(h(_.visible),_.visible?null===(e=_.afterShow)||void 0===e||e.call(_):null===(t=_.afterClose)||void 0===t||t.call(_))}}),[b,h]=t.useState(_.visible);O((()=>{_.visible&&h(!0)}),[_.visible]);const x=t.useRef(null);c(x,_.disableBodyScroll&&b);const w=P(b&&_.visible),k=e.createElement("div",{className:a(`${L}-body`,_.bodyClassName),style:_.bodyStyle},_.children),E=d(_.stopPropagation,o(_,e.createElement("div",{className:L,style:{display:b?void 0:"none",pointerEvents:b?void 0:"none"}},_.mask&&e.createElement(u,{visible:w,forceRender:_.forceRender,destroyOnClose:_.destroyOnClose,onMaskClick:e=>{var t,n;null===(t=_.onMaskClick)||void 0===t||t.call(_,e),_.closeOnMaskClick&&(null===(n=_.onClose)||void 0===n||n.call(_))},style:_.maskStyle,className:a(`${L}-mask`,_.maskClassName),disableBodyScroll:!1,stopPropagation:_.stopPropagation}),e.createElement("div",{className:`${L}-wrap`,role:_.role,"aria-label":_["aria-label"]},e.createElement(m.div,{style:Object.assign(Object.assign({},g),{pointerEvents:g.opacity.to((e=>1===e?"unset":"none"))}),ref:x},_.showCloseButton&&e.createElement("a",{className:a(`${L}-close`,"adm-plain-anchor"),onClick:()=>{var e;null===(e=_.onClose)||void 0===e||e.call(_)}},_.closeIcon),k)))));return e.createElement(p,{active:b,forceRender:_.forceRender,destroyOnClose:_.destroyOnClose},v(_.getContainer,E))},q=t=>{const{action:n}=t;return o(t.action,e.createElement(U,{key:n.key,onClick:t.onAction,className:a("adm-dialog-button",{"adm-dialog-button-bold":n.bold}),fill:"none",shape:"rectangular",block:!0,color:n.danger?"danger":"primary",loading:"auto",disabled:n.disabled},n.text))},K={actions:[],closeOnAction:!1,closeOnMaskClick:!1,getContainer:null},X=t=>{const o=n(K,t),i=e.createElement(e.Fragment,null,!!o.image&&e.createElement("div",{className:W("image-container")},e.createElement(I,{src:o.image,alt:"dialog header image",width:"100%"})),!!o.header&&e.createElement("div",{className:W("header")},e.createElement(f,null,o.header)),!!o.title&&e.createElement("div",{className:W("title")},o.title),e.createElement("div",{className:a(W("content"),!o.content&&W("content-empty"))},"string"==typeof o.content?e.createElement(f,null,o.content):o.content),e.createElement("div",{className:W("footer")},o.actions.map(((t,n)=>{const a=Array.isArray(t)?t:[t];return e.createElement("div",{className:W("action-row"),key:n},a.map(((t,n)=>e.createElement(q,{key:t.key,action:t,onAction:()=>l(void 0,void 0,void 0,(function*(){var e,a,l;yield Promise.all([null===(e=t.onClick)||void 0===e?void 0:e.call(t),null===(a=o.onAction)||void 0===a?void 0:a.call(o,t,n)]),o.closeOnAction&&(null===(l=o.onClose)||void 0===l||l.call(o))}))}))))}))));return e.createElement(H,{className:a(W(),o.className),style:o.style,afterClose:o.afterClose,afterShow:o.afterShow,onMaskClick:o.closeOnMaskClick?()=>{var e;null===(e=o.onClose)||void 0===e||e.call(o)}:void 0,visible:o.visible,getContainer:o.getContainer,bodyStyle:o.bodyStyle,bodyClassName:a(W("body"),o.image&&W("with-image"),o.bodyClassName),maskStyle:o.maskStyle,maskClassName:o.maskClassName,stopPropagation:o.stopPropagation,disableBodyScroll:o.disableBodyScroll,destroyOnClose:o.destroyOnClose,forceRender:o.forceRender,role:"dialog","aria-label":o["aria-label"]},i)};function W(e=""){return"adm-dialog"+(e&&"-")+e}const Z=new Set;function J(t){const n=_(e.createElement(X,Object.assign({},t,{afterClose:()=>{var e;Z.delete(n.close),null===(e=t.afterClose)||void 0===e||e.call(t)}})));return Z.add(n.close),n}const Q={confirmText:"确认",cancelText:"取消"};const Y=$(X,{show:J,alert:function(e){const t={confirmText:y().locale.Dialog.ok},o=n(t,e);return new Promise((e=>{J(Object.assign(Object.assign({},o),{closeOnAction:!0,actions:[{key:"confirm",text:o.confirmText}],onAction:o.onConfirm,onClose:()=>{var t;null===(t=o.onClose)||void 0===t||t.call(o),e()}}))}))},confirm:function(e){const{locale:t}=y(),o=n(Q,{confirmText:t.common.confirm,cancelText:t.common.cancel},e);return new Promise((e=>{J(Object.assign(Object.assign({},o),{closeOnAction:!0,onClose:()=>{var t;null===(t=o.onClose)||void 0===t||t.call(o),e(!1)},actions:[[{key:"cancel",text:o.cancelText,onClick:()=>l(this,void 0,void 0,(function*(){var t;yield null===(t=o.onCancel)||void 0===t?void 0:t.call(o),e(!1)}))},{key:"confirm",text:o.confirmText,bold:!0,onClick:()=>l(this,void 0,void 0,(function*(){var t;yield null===(t=o.onConfirm)||void 0===t?void 0:t.call(o),e(!0)}))}]]}))}))},clear:function(){Z.forEach((e=>{e()}))}}),ee="_avatar_ceno8_20",te="_coin_icon_ceno8_40",ne="_list_item_ceno8_43",oe="_task_row_ceno8_66",ae="_task_column_ceno8_81",le="_item_title_ceno8_87",ie="_item_content_ceno8_96",se="_do_ceno8_104",re="_center_row_ceno8_116",ce="_open_btn_ceno8_127",de="_open_btn_border_ceno8_140",ue="_bottom_banner_widget_ceno8_152",me="_bottom_banner_ceno8_152",pe="_bottom_content_ceno8_177";var ve=t.forwardRef((({as:e="div",...t},n)=>g.jsx(e,{...t,ref:n}))),fe="cf-turnstile-script",_e="onloadTurnstileCallback",ye=e=>!!document.getElementById(e),ge={normal:{width:300,height:65},compact:{width:150,height:140},invisible:{width:0,height:0,overflow:"hidden"},flexible:{minWidth:300,width:"100%",height:65},interactionOnly:{width:"fit-content",height:"auto",display:"flex"}};function be(e){if("invisible"!==e&&"interactionOnly"!==e)return e}var he,xe="unloaded",we=new Promise(((e,t)=>{he={resolve:e,reject:t},"ready"===xe&&e(void 0)})),ke=t.forwardRef(((e,n)=>{let{scriptOptions:o,options:a={},siteKey:l,onWidgetLoad:i,onSuccess:s,onExpire:r,onError:c,onBeforeInteractive:d,onAfterInteractive:u,onUnsupported:m,onTimeout:p,onLoadScript:v,id:f,style:_,as:y="div",injectScript:b=!0,...h}=e,x=a.size,w=t.useCallback((()=>typeof x>"u"?{}:"execute"===a.execution?ge.invisible:"interaction-only"===a.appearance?ge.interactionOnly:ge[x]),[a.execution,x,a.appearance]),[k,E]=t.useState(w()),C=t.useRef(null),[j,N]=t.useState(!1),T=t.useRef(),S=t.useRef(!1),A=f||"cf-turnstile",O=(null==o?void 0:o.id)||fe,I=function(e=fe){let[n,o]=t.useState(!1);return t.useEffect((()=>{let t=()=>{ye(e)&&o(!0)},n=new MutationObserver(t);return n.observe(document,{childList:!0,subtree:!0}),t(),()=>{n.disconnect()}}),[e]),n}(O),R=(null==o?void 0:o.onLoadCallbackName)||_e,P=a.appearance||"always",$=t.useMemo((()=>({sitekey:l,action:a.action,cData:a.cData,callback:e=>{S.current=!0,null==s||s(e)},"error-callback":c,"expired-callback":r,"before-interactive-callback":d,"after-interactive-callback":u,"unsupported-callback":m,theme:a.theme||"auto",language:a.language||"auto",tabindex:a.tabIndex,"response-field":a.responseField,"response-field-name":a.responseFieldName,size:be(x),retry:a.retry||"auto","retry-interval":a.retryInterval||8e3,"refresh-expired":a.refreshExpired||"auto","refresh-timeout":a.refreshTimeout||"auto",execution:a.execution||"render",appearance:a.appearance||"always","feedback-enabled":a.feedbackEnabled||!0,"timeout-callback":p})),[a.action,a.appearance,a.cData,a.execution,a.language,a.refreshExpired,a.responseField,a.responseFieldName,a.retry,a.retryInterval,a.tabIndex,a.theme,a.feedbackEnabled,a.refreshTimeout,l,x]),M=t.useCallback((()=>typeof window<"u"&&!!window.turnstile),[]);return t.useEffect((function(){b&&!j&&(({render:e="explicit",onLoadCallbackName:t=_e,scriptOptions:{nonce:n="",defer:o=!0,async:a=!0,id:l="",appendTo:i,onError:s,crossOrigin:r=""}={}})=>{let c=l||fe;if(ye(c))return;let d=document.createElement("script");d.id=c,d.src=`https://challenges.cloudflare.com/turnstile/v0/api.js?onload=${t}&render=${e}`,document.querySelector(`script[src="${d.src}"]`)||(d.defer=!!o,d.async=!!a,n&&(d.nonce=n),r&&(d.crossOrigin=r),s&&(d.onerror=s,delete window[t]),("body"===i?document.body:document.getElementsByTagName("head")[0]).appendChild(d))})({onLoadCallbackName:R,scriptOptions:{...o,id:O}})}),[b,j,o,O]),t.useEffect((function(){"ready"!==xe&&((e=_e)=>("unloaded"===xe&&(xe="loading",window[e]=()=>{he.resolve(),xe="ready",delete window[e]}),we))(R).then((()=>N(!0))).catch(console.error)}),[]),t.useEffect((function(){if(!C.current||!j)return;let e=!1;return(async()=>{if(e||!C.current)return;let t=window.turnstile.render(C.current,$);T.current=t,T.current&&(null==i||i(T.current))})(),()=>{e=!0,T.current&&(window.turnstile.remove(T.current),S.current=!1)}}),[A,j,$]),t.useImperativeHandle(n,(()=>{let{turnstile:e}=window;return{getResponse(){if((null==e?void 0:e.getResponse)&&T.current&&M())return e.getResponse(T.current);console.warn("Turnstile has not been loaded")},getResponsePromise:async(e=3e4,t=100)=>new Promise(((n,o)=>{let a,l=async()=>{if(S.current&&window.turnstile&&T.current)try{let e=window.turnstile.getResponse(T.current);return a&&clearTimeout(a),e?n(e):o(new Error("No response received"))}catch(i){return a&&clearTimeout(a),console.warn("Failed to get response",i),o(new Error("Failed to get response"))}a||(a=setTimeout((()=>{a&&clearTimeout(a),o(new Error("Timeout"))}),e)),await new Promise((e=>setTimeout(e,t))),await l()};l()})),reset(){if((null==e?void 0:e.reset)&&T.current&&M()){"execute"===a.execution&&E(ge.invisible);try{S.current=!1,e.reset(T.current)}catch(t){console.warn(`Failed to reset Turnstile widget ${T}`,t)}}else console.warn("Turnstile has not been loaded")},remove(){(null==e?void 0:e.remove)&&T.current&&M()?(E(ge.invisible),S.current=!1,e.remove(T.current),T.current=null):console.warn("Turnstile has not been loaded")},render(){if(!(null==e?void 0:e.render)||!C.current||!M()||T.current)return void console.warn("Turnstile has not been loaded or container not found");let t=e.render(C.current,$);return T.current=t,T.current&&(null==i||i(T.current)),"execute"!==a.execution&&E(x?ge[x]:{}),t},execute(){"execute"===a.execution?(null==e?void 0:e.execute)&&C.current&&T.current&&M()?(e.execute(C.current,$),E(x?ge[x]:{})):console.warn("Turnstile has not been loaded or container not found"):console.warn('Execution mode is not set to "execute"')},isExpired:()=>(null==e?void 0:e.isExpired)&&T.current&&M()?e.isExpired(T.current):(console.warn("Turnstile has not been loaded"),!1)}}),[T,a.execution,x,$,C,M,j,i]),t.useEffect((()=>{I&&!j&&window.turnstile&&N(!0)}),[j,I]),t.useEffect((()=>{E(w())}),[a.execution,x,P]),t.useEffect((()=>{!I||"function"!=typeof v||v()}),[I]),g.jsx(ve,{ref:C,as:y,id:A,style:{...k,..._},...h})}));ke.displayName="Turnstile";const{VITE_APP_ENV:Ee}={BASE_URL:"/",DEV:!1,MODE:"prod",PROD:!0,SSR:!1,VITE_APP_ENV:"prod",VITE_BASE_URL:"https://api.tongifter.xyz",VITE_RECHARGE_ADDRESS:"0QBVHX3_gVwPZnzKPob1zpZ3tOX67xXzuFe_Ux2Pyr_R7Yms"},{getGiftInfo:Ce,getTaskProgress:je,updateTask:Ne,openGift:Te}=T("common"),Se=b((e=>e.common))((n=>{var o,a,l,i,s;const{tgUserInfoRaw:r,tgUserInfo:c}=n,{location:d,pathname:u,search:m,hash:p}=h(),{t:v,i18n:f}=x(),[_]=w(),y=_.get("id"),b=_.get("inviterId"),[T,S]=t.useState("0x4AAAAAAA0Gfu6U8AVORjc0"),[A,O]=t.useState(!1),R=e.useRef(),[P,$]=t.useState({}),[F,V]=t.useState({}),[U,L]=t.useState(0),[G,H]=t.useState(!1),[q,K]=t.useState(!1),[X,W]=t.useState(!1),Z=async()=>{const[e]=await je(r,{id:y});200===(null==e?void 0:e.code)&&V(null==e?void 0:e.data)},J=e=>{F.task.map((t=>t.taskId===e.taskId?{...t,...e}:t));let t={...F};V(t)},Q=e=>{if(e)return e.completed?void 0:1===e.status?g.jsx(I,{className:te,src:z,width:32,height:32,placeholder:g.jsx(M.Paragraph,{style:{width:"100%"}}),onClick:t=>{t.stopPropagation(),ve(e)},style:{borderRadius:10}}):2===e.status?g.jsx(C,{style:{"--size":"24px","--color":"red"}}):g.jsx("div",{className:se,children:v("receive_btn_do")})},ve=async e=>{e.status=2,J(e);const[t]=await Ne(r,{giftId:y,taskId:e.taskId});200===(null==t?void 0:t.code)&&Z()},fe=async()=>{H(!1),W(!0),K(!0)},_e=async()=>{var e;await Z(),F.completed?(null==(e=R.current)||e.render(),O(!0)):N(v("receive_tips_tips_1"),3)},ye=()=>{"prod"!=Ee&&S("1x00000000000000000000AA"),(async()=>{const[e]=await Ce(r,{id:y});200===(null==e?void 0:e.code)?$(null==e?void 0:e.data):N(v(null==e?void 0:e.message),3)})(),Z()};return k.useActivate((()=>{ye()})),t.useEffect((()=>{ye()}),[d]),t.useEffect((()=>{var e;null!=F.completed&&null!=P.gift&&(99==P.gift.status||P.gift.userId==c.id||1==P.invalidType?L(2):(F.completed||(L(1),q||(H(!0),K(!1))),F.completed&&(null==(e=P.myAward)?void 0:e.surplusTimes)<=0&&L(2),F.completed&&(null==P.myAward||P.myAward.surplusTimes>0)&&(L(1),H(!1),K(!0))))}),[F,P]),g.jsxs("div",{className:"warp",children:[0==U?g.jsx("div",{className:"content1",style:{padding:"16px"},children:g.jsx(M,{className:pe,animated:!0})}):null,1==U?g.jsxs("div",{className:"content1",style:{padding:"16px"},children:[X?null:g.jsx("div",{className:pe,style:{backgroundImage:`url(${null==(o=P.gift)?void 0:o.coverImg})`}}),X?g.jsx("div",{className:pe,style:{backgroundImage:`url(${null==(a=P.gift)?void 0:a.coverImg})`},children:null==(l=F.task)?void 0:l.map(((e,t)=>g.jsxs("div",{className:ne,onClick:()=>{(async e=>{e.status=1,J(e),1==e.type&&E("web_app_open_tg_link",{path_full:e.value.replace("@","")}),2==e.type&&E("web_app_open_link",{url:e.value,try_instant_view:!1})})(e)},children:[g.jsxs("div",{className:oe,children:[e.completed?g.jsx(I,{className:ee,src:D,width:30,height:30,fit:"cover",style:{borderRadius:14}}):g.jsx(I,{className:ee,src:"/img/icon_lock.Bp71GFIS.jpg",width:30,height:30,fit:"cover",style:{borderRadius:14}}),g.jsxs("div",{className:ae,children:[g.jsx("span",{className:le,children:e.title}),g.jsx("span",{className:ie,children:e.desc})]})]}),Q(e)]},t)))}):null,g.jsxs("div",{className:re,children:[q?g.jsx("div",{onClick:async()=>{var e,t,n;if(F.completed)if((null==(e=P.myAward)?void 0:e.surplusTimes)>0)if("prod"!=Ee)Y.confirm({content:v("add_recive_more_confirm_content",{v1:null==(t=P.myAward)?void 0:t.surplusTimes}),cancelText:v("add_recive_more_confirm_cancel_text"),confirmText:v("add_recive_more_confirm_confirm_text"),onConfirm:()=>{alert(1)}});else{E("web_app_open_popup",{title:v("add_recive_more_confirm_tips"),message:v("add_recive_more_confirm_content",{v1:null==(n=P.myAward)?void 0:n.surplusTimes}),buttons:[{id:"0x0ok",type:"default",text:v("add_recive_more_confirm_confirm_text")},{id:"0x0close",type:"default",text:v("add_recive_more_confirm_cancel_text")}]});const e=j("popup_closed",(t=>{e(),"0x0ok"===t.button_id&&_e()}))}else _e()},className:de,children:g.jsx("div",{className:ce,children:v("receive_btn_receive")})}):null,G?g.jsx("div",{onClick:fe,className:de,children:g.jsx("div",{onClick:fe,className:ce,children:v("receive_btn_open")})}):null]}),(null==(i=P.myAward)?void 0:i.surplusTimes)>0?g.jsx("div",{className:ue,children:g.jsx("div",{className:me,children:v("add_recive_more_open_tips",{v1:null==(s=P.myAward)?void 0:s.surplusTimes})})}):null]}):null,2==U?g.jsx("div",{className:"content1",style:{color:"#ffffff"},children:g.jsx(B,{giftId:y})}):null,A?g.jsx("div",{className:"cf_turnstile_pop",onClick:e=>{O(!1)},children:g.jsx("div",{className:"item",children:g.jsx(ke,{ref:R,siteKey:T,options:{language:f.language},onSuccess:e=>{(async e=>{var t;if(F.completed){O(!1);const[n]=await Te(r,{id:y,inviterId:b,cfvt:e});200===(null==n?void 0:n.code)?(N(v("receive_tips_tips_2",{v1:null==n?void 0:n.data,v2:null==(t=P.gift)?void 0:t.tokenSymbol}),1),L(2)):N(null==n?void 0:n.message,3)}else N(v("receive_tips_tips_1"),3)})(e)},onClick:e=>{e.stopPropagation()}})})}):null]})}));export{Se as default};
